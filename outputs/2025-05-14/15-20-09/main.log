[2025-05-14 15:20:09,976][__main__][INFO] - Initializing data provider
[2025-05-14 15:20:09,978][__main__][INFO] - Data directory: C:\Users\Fx\PycharmProjects\fx-ai/dnb/mlgo
[2025-05-14 15:20:09,979][data.provider.data_bento.databento_file_provider][INFO] - Scanning for metadata in 'C:\Users\Fx\PycharmProjects\fx-ai/dnb/mlgo'...
[2025-05-14 15:20:09,992][data.provider.data_bento.databento_file_provider][INFO] - Found 6 directories, indexed 183 files
[2025-05-14 15:20:09,993][__main__][INFO] - Setting up simulator
[2025-05-14 15:20:09,995][__main__][INFO] - Loading data for MLGO from 2025-03-27 to 2025-03-27
[2025-05-14 15:20:09,995][__main__][INFO] - Using timeframes: ['1s', '1m', '5m', '1d']
[2025-05-14 15:20:09,995][__main__][INFO] - Initializing market from 2025-03-27 00:00:00 to 2025-03-27 23:59:59
[2025-05-14 15:20:09,995][__main__][INFO] - Loading data for MLGO from 2025-03-27 00:00:00+00:00 to 2025-03-27 23:59:59.999999+00:00
[2025-05-14 15:20:09,995][__main__][INFO] - Loading bars_1s from provider for MLGO
[2025-05-14 15:20:11,213][data.provider.data_bento.databento_file_provider][INFO] - Loaded 6466 1s bars for MLGO
[2025-05-14 15:20:11,214][__main__][INFO] - Loaded 6466 rows of bars_1s data for MLGO
[2025-05-14 15:20:11,214][__main__][INFO] - Loading bars_1m from provider for MLGO
[2025-05-14 15:20:11,400][data.provider.data_bento.databento_file_provider][INFO] - Loaded 571 1m bars for MLGO
[2025-05-14 15:20:11,401][__main__][INFO] - Loaded 571 rows of bars_1m data for MLGO
[2025-05-14 15:20:11,401][__main__][INFO] - Loading bars_5m from provider for MLGO
[2025-05-14 15:20:11,401][data.provider.data_bento.databento_file_provider][INFO] - No 5m bar files found for MLGO
[2025-05-14 15:20:11,401][data.provider.data_bento.databento_file_provider][INFO] - No direct 5m bars found for MLGO, building from 1m bars
[2025-05-14 15:20:11,415][data.provider.data_bento.databento_file_provider][INFO] - Loaded 571 1m bars for MLGO
[2025-05-14 15:20:11,420][data.provider.data_bento.databento_file_provider][INFO] - Built 159 5m bars from 1m bars for MLGO
[2025-05-14 15:20:11,421][__main__][INFO] - Loaded 159 rows of bars_5m data for MLGO
[2025-05-14 15:20:11,421][__main__][INFO] - Loading bars_1d from provider for MLGO
[2025-05-14 15:20:11,441][data.provider.data_bento.databento_file_provider][INFO] - Loaded 1 1d bars for MLGO
[2025-05-14 15:20:11,442][__main__][INFO] - Loaded 1 rows of bars_1d data for MLGO
[2025-05-14 15:20:11,442][__main__][INFO] - Loading trades from provider for MLGO
[2025-05-14 15:20:16,785][data.provider.data_bento.databento_file_provider][INFO] - Loaded 21111 trades for MLGO
[2025-05-14 15:20:16,785][__main__][INFO] - Loaded 21111 rows of trades data for MLGO
[2025-05-14 15:20:16,785][__main__][INFO] - Loading quotes from provider for MLGO
[2025-05-14 15:21:46,696][data.provider.data_bento.databento_file_provider][INFO] - Loaded 193387 quotes for MLGO
[2025-05-14 15:21:46,698][__main__][INFO] - Loaded 193387 rows of quotes data for MLGO
[2025-05-14 15:21:46,699][__main__][INFO] - Loading status from provider for MLGO
[2025-05-14 15:21:47,093][data.provider.data_bento.databento_file_provider][INFO] - Loaded 6 status records for MLGO
[2025-05-14 15:21:47,093][__main__][INFO] - Loaded 6 rows of status data for MLGO
[2025-05-14 15:21:47,093][__main__][INFO] - Data for MLGO is not a DataFrame type: <class 'dict'>
[2025-05-14 15:21:47,094][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:47,095][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:47,095][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:47,095][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:47,095][__main__][INFO] - Extracting features for MLGO
[2025-05-14 15:21:47,095][__main__][WARNING] - No features extracted for MLGO
[2025-05-14 15:21:47,096][__main__][INFO] - Creating trading environment
[2025-05-14 15:21:47,097][__main__][INFO] - Using CPU device
[2025-05-14 15:21:47,097][__main__][INFO] - Creating multi-branch transformer model
[2025-05-14 15:21:47,098][__main__][INFO] - Model config: {'hf_seq_len': 60, 'hf_feat_dim': 20, 'mf_seq_len': 30, 'mf_feat_dim': 15, 'lf_seq_len': 30, 'lf_feat_dim': 10, 'static_feat_dim': 15, 'd_model': 64, 'd_fused': 256, 'hf_layers': 2, 'mf_layers': 2, 'lf_layers': 2, 'hf_heads': 4, 'mf_heads': 4, 'lf_heads': 4, 'action_dim': 1, 'continuous_action': True, 'dropout': 0.1}
[2025-05-14 15:21:47,107][__main__][INFO] - Model created successfully
[2025-05-14 15:21:47,112][__main__][INFO] - W&B callback added successfully
[2025-05-14 15:21:47,112][__main__][INFO] - Setting up PPO trainer
[2025-05-14 15:21:47,113][__main__][INFO] - Training parameters: {'lr': 0.0003, 'gamma': 0.99, 'gae_lambda': 0.95, 'clip_eps': 0.2, 'critic_coef': 0.5, 'entropy_coef': 0.01, 'max_grad_norm': 0.5, 'n_epochs': 10, 'batch_size': 64, 'buffer_size': 2048, 'n_episodes_per_update': 8}
[2025-05-14 15:21:48,763][__main__][INFO] - PPO Trainer initialized on device: cpu
[2025-05-14 15:21:48,764][__main__][INFO] - Model: MultiBranchTransformer
[2025-05-14 15:21:48,764][__main__][INFO] - Learning rate: 0.0003
[2025-05-14 15:21:48,764][__main__][INFO] - Starting training for 100 updates
[2025-05-14 15:21:48,764][__main__][INFO] - Starting training for 100 updates
[2025-05-14 15:21:50,886][__main__][INFO] - Update 1/100
[2025-05-14 15:21:50,887][__main__][INFO] - Collecting 8 episodes...
[2025-05-14 15:21:50,889][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:50,890][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:50,890][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:50,903][__main__][INFO] - SELL order filled: 93 shares @ $9.9500
[2025-05-14 15:21:50,904][__main__][INFO] - Market order 1000 (sell) filled: 93 shares @ $9.9500
[2025-05-14 15:21:50,905][__main__][INFO] - Reached end of data
[2025-05-14 15:21:50,905][__main__][INFO] - Episode 1 finished: 1 steps, reward: 1850.70, PnL: $1850.70
[2025-05-14 15:21:50,905][__main__][INFO] - Episode finished - PnL: $1850.70 (1.85%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:50,907][__main__][INFO] - Episode 1: reward=-0.10, length=1
[2025-05-14 15:21:50,909][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:50,910][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:50,911][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:50,921][__main__][INFO] - SELL order filled: 68 shares @ $9.9500
[2025-05-14 15:21:50,922][__main__][INFO] - Market order 1000 (sell) filled: 68 shares @ $9.9500
[2025-05-14 15:21:50,923][__main__][INFO] - Reached end of data
[2025-05-14 15:21:50,923][__main__][INFO] - Episode 2 finished: 1 steps, reward: 1353.20, PnL: $1353.20
[2025-05-14 15:21:50,923][__main__][INFO] - Episode finished - PnL: $1353.20 (1.35%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:50,925][__main__][INFO] - Episode 2: reward=-0.10, length=1
[2025-05-14 15:21:50,928][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:50,929][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:50,930][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:50,940][__main__][INFO] - SELL order filled: 8 shares @ $9.9500
[2025-05-14 15:21:50,941][__main__][INFO] - Market order 1000 (sell) filled: 8 shares @ $9.9500
[2025-05-14 15:21:50,941][__main__][INFO] - Reached end of data
[2025-05-14 15:21:50,942][__main__][INFO] - Episode 3 finished: 1 steps, reward: 159.20, PnL: $159.20
[2025-05-14 15:21:50,942][__main__][INFO] - Episode finished - PnL: $159.20 (0.16%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:50,943][__main__][INFO] - Episode 3: reward=-0.10, length=1
[2025-05-14 15:21:50,945][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:50,946][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:50,947][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:50,961][__main__][INFO] - SELL order filled: 1 shares @ $9.9500
[2025-05-14 15:21:50,962][__main__][INFO] - Market order 1000 (sell) filled: 1 shares @ $9.9500
[2025-05-14 15:21:50,962][__main__][INFO] - Reached end of data
[2025-05-14 15:21:50,963][__main__][INFO] - Episode 4 finished: 1 steps, reward: 19.90, PnL: $19.90
[2025-05-14 15:21:50,963][__main__][INFO] - Episode finished - PnL: $19.90 (0.02%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:50,965][__main__][INFO] - Episode 4: reward=-0.10, length=1
[2025-05-14 15:21:50,966][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:50,967][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:50,968][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:50,980][__main__][INFO] - BUY order filled: 36 shares @ $10.0500
[2025-05-14 15:21:50,981][__main__][INFO] - Market order 1000 (buy) filled: 36 shares @ $10.0500
[2025-05-14 15:21:50,982][__main__][INFO] - Reached end of data
[2025-05-14 15:21:50,983][__main__][INFO] - Episode 5 finished: 1 steps, reward: 0.00, PnL: $0.00
[2025-05-14 15:21:50,983][__main__][INFO] - Episode finished - PnL: $0.00 (0.00%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:50,984][__main__][INFO] - Episode 5: reward=-0.10, length=1
[2025-05-14 15:21:50,986][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:50,986][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:50,987][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:50,996][__main__][INFO] - SELL order filled: 86 shares @ $9.9500
[2025-05-14 15:21:50,997][__main__][INFO] - Market order 1000 (sell) filled: 86 shares @ $9.9500
[2025-05-14 15:21:50,998][__main__][INFO] - Reached end of data
[2025-05-14 15:21:50,998][__main__][INFO] - Episode 6 finished: 1 steps, reward: 1711.40, PnL: $1711.40
[2025-05-14 15:21:50,998][__main__][INFO] - Episode finished - PnL: $1711.40 (1.71%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:51,000][__main__][INFO] - Episode 6: reward=-0.10, length=1
[2025-05-14 15:21:51,002][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:51,003][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:51,003][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:51,014][__main__][INFO] - BUY order filled: 17 shares @ $10.0500
[2025-05-14 15:21:51,015][__main__][INFO] - Market order 1000 (buy) filled: 17 shares @ $10.0500
[2025-05-14 15:21:51,016][__main__][INFO] - Reached end of data
[2025-05-14 15:21:51,016][__main__][INFO] - Episode 7 finished: 1 steps, reward: 0.00, PnL: $0.00
[2025-05-14 15:21:51,016][__main__][INFO] - Episode finished - PnL: $0.00 (0.00%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:51,018][__main__][INFO] - Episode 7: reward=-0.10, length=1
[2025-05-14 15:21:51,021][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-14 15:21:51,022][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-14 15:21:51,023][__main__][INFO] - Resetting to timestamp: None
[2025-05-14 15:21:51,034][__main__][INFO] - SELL order filled: 94 shares @ $9.9500
[2025-05-14 15:21:51,034][__main__][INFO] - Market order 1000 (sell) filled: 94 shares @ $9.9500
[2025-05-14 15:21:51,036][__main__][INFO] - Reached end of data
[2025-05-14 15:21:51,036][__main__][INFO] - Episode 8 finished: 1 steps, reward: 1870.60, PnL: $1870.60
[2025-05-14 15:21:51,036][__main__][INFO] - Episode finished - PnL: $1870.60 (1.87%), Win Rate: 0.0%, Trades: 0
[2025-05-14 15:21:51,038][__main__][INFO] - Episode 8: reward=-0.10, length=1
[2025-05-14 15:21:51,039][__main__][INFO] - Computing advantages - rewards: torch.Size([8]), values: torch.Size([8, 1]), dones: torch.Size([8])
[2025-05-14 15:21:51,040][__main__][INFO] - After reshaping - rewards: (8, 1), values: (8, 1), dones: (8, 1)
[2025-05-14 15:21:51,041][__main__][INFO] - Computed - advantages: torch.Size([8, 1]), returns: torch.Size([8, 1])
[2025-05-14 15:21:51,041][__main__][INFO] - Buffer sizes - buffer: 8, advantages: (8, 1)
[2025-05-14 15:21:51,594][__main__][INFO] - Elapsed time: 0.71s
