[2025-05-13 22:05:23,047][__main__][INFO] - Configuration:
quick_test: false
callbacks:
  save_freq: 5
  log_freq: 10
  early_stopping:
    enabled: true
    patience: 10
    min_delta: 0.0
simulation:
  feature_config:
    hf_seq_len: 60
    hf_feat_dim: 20
    mf_seq_len: 30
    mf_feat_dim: 15
    lf_seq_len: 30
    lf_feat_dim: 10
    static_feat_dim: 15
    use_volume_profile: true
    use_tape_features: true
    use_level2_features: true
  market_config:
    slippage_factor: 0.001
  execution_config:
    commission_per_share: 0.0
  portfolio_config:
    initial_cash: 100000.0
model:
  hf_seq_len: 60
  hf_feat_dim: 20
  mf_seq_len: 30
  mf_feat_dim: 15
  lf_seq_len: 30
  lf_feat_dim: 10
  static_feat_dim: 15
  d_model: 64
  d_fused: 256
  hf_layers: 2
  mf_layers: 2
  lf_layers: 2
  hf_heads: 4
  mf_heads: 4
  lf_heads: 4
  action_dim: 1
  continuous_action: true
  dropout: 0.1
env:
  state_dim: 1000
  max_steps: 500
  normalize_state: true
  random_reset: true
  max_position: 1.0
  reward:
    type: momentum
    scaling: 2.0
    trade_penalty: 0.1
    hold_penalty: 0.0
    early_exit_bonus: 0.5
    flush_prediction_bonus: 2.0
    momentum_threshold: 0.5
    volume_surge_threshold: 5.0
    tape_speed_threshold: 3.0
    tape_imbalance_threshold: 0.7
data:
  provider_type: file
  data_dir: ${hydra:runtime.cwd}/dnb/mlgo
  symbol_info_file: null
  verbose: false
  dbn_cache_size: 32
  use_cache: true
  symbol: MLGO
  start_date: '2025-03-27'
  end_date: '2025-03-27'
  timeframes:
  - 1s
  - 1m
  - 5m
  - 1d
  data_types:
  - trades
  - quotes
  - bars_1s
  - bars_1m
  - bars_5m
  - bars_1d
  - status
  api:
    key: ${oc.env:DATABENTO_API_KEY,}
    dataset: XNAS.ITCH
  live:
    api_key: ${oc.env:DATABENTO_API_KEY,}
    dataset: XNAS.ITCH
    heartbeat_interval: 5
training:
  lr: 0.0003
  gamma: 0.99
  gae_lambda: 0.95
  clip_eps: 0.2
  critic_coef: 0.5
  entropy_coef: 0.01
  max_grad_norm: 0.5
  n_epochs: 10
  batch_size: 64
  buffer_size: 2048
  n_episodes_per_update: 8
  total_updates: 100
  device: auto
wandb:
  enabled: true
  project_name: fx-ai
  entity: null
  log_code: true
  log_model: true
  log_frequency:
    steps: 1
    gradients: 100
    model_checkpoints: 5
    custom_charts: 5
  watch_model: true
  log_batch_metrics: false
  visualizations:
    position_charts: true
    trade_analysis: true
    market_indicators: true
    action_distributions: true

[2025-05-13 22:05:23,047][__main__][INFO] - Initializing data provider
[2025-05-13 22:05:23,048][data.provider.data_bento.databento_file_provider][INFO] - Scanning for metadata in '/Users/fx/Repositories/FxAIv2/dnb/mlgo'...
[2025-05-13 22:05:23,052][data.provider.data_bento.databento_file_provider][INFO] - Found 6 directories, indexed 183 files
[2025-05-13 22:05:23,052][__main__][INFO] - Setting up simulator
[2025-05-13 22:05:23,053][__main__][INFO] - Loading data for MLGO from 2025-03-27 to 2025-03-27
[2025-05-13 22:05:23,053][__main__][INFO] - Initializing market from 2025-03-27 00:00:00 to 2025-03-27 23:59:59
[2025-05-13 22:05:23,053][__main__][INFO] - Loading data for MLGO from 2025-03-27 00:00:00+00:00 to 2025-03-27 23:59:59.999999+00:00
[2025-05-13 22:05:23,053][__main__][INFO] - Loading bars_1s from provider for MLGO
[2025-05-13 22:05:23,662][data.provider.data_bento.databento_file_provider][INFO] - Loaded 6466 1s bars for MLGO
[2025-05-13 22:05:23,663][__main__][INFO] - Loaded 6466 rows of bars_1s data for MLGO
[2025-05-13 22:05:23,663][__main__][INFO] - Loading bars_1m from provider for MLGO
[2025-05-13 22:05:23,805][data.provider.data_bento.databento_file_provider][INFO] - Loaded 571 1m bars for MLGO
[2025-05-13 22:05:23,805][__main__][INFO] - Loaded 571 rows of bars_1m data for MLGO
[2025-05-13 22:05:23,805][__main__][INFO] - Loading bars_5m from provider for MLGO
[2025-05-13 22:05:23,805][data.provider.data_bento.databento_file_provider][INFO] - No 5m bar files found for MLGO
[2025-05-13 22:05:23,805][data.provider.data_bento.databento_file_provider][INFO] - No direct 5m bars found for MLGO, building from 1m bars
[2025-05-13 22:05:23,811][data.provider.data_bento.databento_file_provider][INFO] - Loaded 571 1m bars for MLGO
[2025-05-13 22:05:23,817][data.provider.data_bento.databento_file_provider][INFO] - Built 159 5m bars from 1m bars for MLGO
[2025-05-13 22:05:23,817][__main__][INFO] - Loaded 159 rows of bars_5m data for MLGO
[2025-05-13 22:05:23,817][__main__][INFO] - Loading bars_1d from provider for MLGO
[2025-05-13 22:05:23,825][data.provider.data_bento.databento_file_provider][INFO] - Loaded 1 1d bars for MLGO
[2025-05-13 22:05:23,825][__main__][INFO] - Loaded 1 rows of bars_1d data for MLGO
[2025-05-13 22:05:23,825][__main__][INFO] - Loading trades from provider for MLGO
[2025-05-13 22:05:26,441][data.provider.data_bento.databento_file_provider][INFO] - Loaded 21111 trades for MLGO
[2025-05-13 22:05:26,442][__main__][INFO] - Loaded 21111 rows of trades data for MLGO
[2025-05-13 22:05:26,442][__main__][INFO] - Loading quotes from provider for MLGO
[2025-05-13 22:06:09,589][data.provider.data_bento.databento_file_provider][INFO] - Loaded 193387 quotes for MLGO
[2025-05-13 22:06:09,591][__main__][INFO] - Loaded 193387 rows of quotes data for MLGO
[2025-05-13 22:06:09,591][__main__][INFO] - Loading status from provider for MLGO
[2025-05-13 22:06:09,816][data.provider.data_bento.databento_file_provider][INFO] - Loaded 6 status records for MLGO
[2025-05-13 22:06:09,816][__main__][INFO] - Loaded 6 rows of status data for MLGO
[2025-05-13 22:06:09,816][__main__][INFO] - Data for MLGO is not a DataFrame type: <class 'dict'>
[2025-05-13 22:06:09,816][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-13 22:06:09,816][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-13 22:06:09,816][__main__][WARNING] - WARNING: Could not find valid price data, using default values
[2025-05-13 22:06:09,816][__main__][INFO] - Market initialized: Price=$10.0000, Bid=$9.9500, Ask=$10.0500, Spread=$0.1000
[2025-05-13 22:06:09,817][__main__][INFO] - Extracting features for MLGO
[2025-05-13 22:06:09,817][__main__][WARNING] - No features extracted for MLGO
[2025-05-13 22:06:09,817][__main__][INFO] - Creating trading environment
[2025-05-13 22:06:09,833][__main__][INFO] - Using device: mps
[2025-05-13 22:06:09,833][__main__][INFO] - Creating multi-branch transformer model
[2025-05-13 22:06:09,892][__main__][INFO] - Model config: {'hf_seq_len': 60, 'hf_feat_dim': 20, 'mf_seq_len': 30, 'mf_feat_dim': 15, 'lf_seq_len': 30, 'lf_feat_dim': 10, 'static_feat_dim': 15, 'd_model': 64, 'd_fused': 256, 'hf_layers': 2, 'mf_layers': 2, 'lf_layers': 2, 'hf_heads': 4, 'mf_heads': 4, 'lf_heads': 4, 'action_dim': 1, 'continuous_action': True, 'dropout': 0.1}
[2025-05-13 22:06:09,892][__main__][INFO] - Model structure: MultiBranchTransformer(
  (hf_proj): Linear(in_features=20, out_features=64, bias=True)
  (hf_pos_enc): PositionalEncoding(
    (dropout): Dropout(p=0.1, inplace=False)
  )
  (hf_encoder): TransformerEncoder(
    (layers): ModuleList(
      (0-1): 2 x TransformerEncoderLayer(
        (self_attn): MultiheadAttention(
          (out_proj): NonDynamicallyQuantizableLinear(in_features=64, out_features=64, bias=True)
        )
        (linear1): Linear(in_features=64, out_features=128, bias=True)
        (dropout): Dropout(p=0.1, inplace=False)
        (linear2): Linear(in_features=128, out_features=64, bias=True)
        (norm1): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (norm2): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (dropout1): Dropout(p=0.1, inplace=False)
        (dropout2): Dropout(p=0.1, inplace=False)
        (activation): GELU(approximate='none')
      )
    )
    (norm): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
  )
  (mf_proj): Linear(in_features=15, out_features=64, bias=True)
  (mf_pos_enc): PositionalEncoding(
    (dropout): Dropout(p=0.1, inplace=False)
  )
  (mf_encoder): TransformerEncoder(
    (layers): ModuleList(
      (0-1): 2 x TransformerEncoderLayer(
        (self_attn): MultiheadAttention(
          (out_proj): NonDynamicallyQuantizableLinear(in_features=64, out_features=64, bias=True)
        )
        (linear1): Linear(in_features=64, out_features=128, bias=True)
        (dropout): Dropout(p=0.1, inplace=False)
        (linear2): Linear(in_features=128, out_features=64, bias=True)
        (norm1): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (norm2): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (dropout1): Dropout(p=0.1, inplace=False)
        (dropout2): Dropout(p=0.1, inplace=False)
        (activation): GELU(approximate='none')
      )
    )
    (norm): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
  )
  (lf_proj): Linear(in_features=10, out_features=64, bias=True)
  (lf_pos_enc): PositionalEncoding(
    (dropout): Dropout(p=0.1, inplace=False)
  )
  (lf_encoder): TransformerEncoder(
    (layers): ModuleList(
      (0-1): 2 x TransformerEncoderLayer(
        (self_attn): MultiheadAttention(
          (out_proj): NonDynamicallyQuantizableLinear(in_features=64, out_features=64, bias=True)
        )
        (linear1): Linear(in_features=64, out_features=128, bias=True)
        (dropout): Dropout(p=0.1, inplace=False)
        (linear2): Linear(in_features=128, out_features=64, bias=True)
        (norm1): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (norm2): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (dropout1): Dropout(p=0.1, inplace=False)
        (dropout2): Dropout(p=0.1, inplace=False)
        (activation): GELU(approximate='none')
      )
    )
    (norm): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
  )
  (static_encoder): Sequential(
    (0): Linear(in_features=15, out_features=64, bias=True)
    (1): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
    (2): GELU(approximate='none')
    (3): Linear(in_features=64, out_features=64, bias=True)
    (4): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
    (5): GELU(approximate='none')
  )
  (fusion): AttentionFusion(
    (self_attention): MultiheadAttention(
      (out_proj): NonDynamicallyQuantizableLinear(in_features=64, out_features=64, bias=True)
    )
    (proj): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
      (2): GELU(approximate='none')
      (3): Dropout(p=0.1, inplace=False)
    )
  )
  (actor): ActorNetwork(
    (shared): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
      (2): GELU(approximate='none')
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
      (5): GELU(approximate='none')
    )
    (mean): Linear(in_features=256, out_features=1, bias=True)
  )
  (critic): CriticNetwork(
    (critic): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
      (2): GELU(approximate='none')
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
      (5): GELU(approximate='none')
      (6): Linear(in_features=256, out_features=1, bias=True)
    )
  )
)
[2025-05-13 22:06:10,289][__main__][ERROR] - Error during model forward pass: 'tuple' object has no attribute 'shape'
[2025-05-13 22:06:10,291][__main__][INFO] - Setting up PPO trainer
[2025-05-13 22:06:11,075][__main__][INFO] - PPO Trainer initialized on device: mps
[2025-05-13 22:06:11,075][__main__][INFO] - Model: MultiBranchTransformer
[2025-05-13 22:06:11,075][__main__][INFO] - Learning rate: 0.0003
[2025-05-13 22:06:11,075][__main__][INFO] - Starting training for 100 updates
[2025-05-13 22:06:11,076][__main__][INFO] - Starting training for 100 updates
[2025-05-13 22:06:11,386][urllib3.connectionpool][WARNING] - Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x334a3dba0>: Failed to establish a new connection: [Errno 61] Connection refused')': /api/4504800232407040/envelope/
[2025-05-13 22:06:11,388][urllib3.connectionpool][WARNING] - Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x113b18520>: Failed to establish a new connection: [Errno 61] Connection refused')': /api/4504800232407040/envelope/
[2025-05-13 22:06:11,391][urllib3.connectionpool][WARNING] - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x113b18b50>: Failed to establish a new connection: [Errno 61] Connection refused')': /api/4504800232407040/envelope/
